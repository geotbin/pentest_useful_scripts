#!/usr/bin/python
# -*- coding: utf-8 -*- 
# Code by abaykandotcom
"""
     _-----_
    |       |    
    |--(o)--|     ╒ 53R3N17Y ════════════════════════════════════╕
   `---------´    │Python based script for Information Gathering.│
    ( _´U`_ )     ╘══════════════════════════════════════════════╛ 
    /___A___\     
     |  ~  |
   __'.___.'__
 ´   `  |° ´ Y `
  abaykandotcom
"""

from sys     import argv
import requests, json
import optparse
import os, re
from lxml import html
import sys

################################  Banner   ################################

os.system('clear')
print '\r'

################################ Functions ################################


_headers = {
    'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.11 (KHTML, like Gecko) Chrome/23.0.1271.64 Safari/537.11',
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
    'Accept-Encoding': 'gzip,deflate,sdch',
    'Accept-Language': 'en-US,en;q=0.8',
    'Connection': 'keep-alive'
}

empty_Website = "\n\t[=] Please Enter A Website :/\n\t\t{cyan}~ abaykan :)"

wrong_URL = "\n\t{red}[=] Please Enter a Valid And Correct URL (i.e, hack.me)\n\t\t{cyan}~ abaykan :)"
str_Index = "\n\t{red}[=] Please Input a Integer (i.e, 1, 2, 3) :\\\n\t\t{cyan}~ abaykan :)"

val_Select = "\t{}[$] Please Use The Index Value From The List\n\t\t[+] Not By Your Own :/\n\t\t\t ~ abaykan  \n"

def webNotEmpty(website):
    """
    Check Whether if the website is empty or not and return valid / !valid
    """
    if len(website) >= 1:
        return "valid"
    else:
        return "!valid"

def validWebsite(website):
    """
    Checks With a Regex If The URL Entered Is Correct Or Not! (User can use IP Too :)
    """
    web = webNotEmpty(website)
    if web is "valid":
        if not (re.match(r"(^(http://|https://)?([a-z0-9][a-z0-9-]*\.)+[a-z0-9][a-z0-9-]*$)", website)):
            exit(wrong_URL)
    else:
        exit(empty_Website)

def cleanURL(website):
    """
    Removes ["http://", "http://www.", "https://", "https://www.", "www."] from the start of the Url!
    """
    web = validWebsite(website)
    website = website.replace("http://", "")
    website = website.replace("http://www.", "")
    website = website.replace("https://", "")
    website = website.replace("https://www.", "")
    website = website.replace("www.", ""); return(website)

def removeHTTP(website):
    """
    Removes ["http://", "http://www.", "https://", "https://www.", "www."] from the start of the Url and returns it!
    """
    website = cleanURL(website); return(website)

def addHTTP(website):
    """
    Removes ["http://", "http://www.", "https://", "https://www.", "www."] from the start of the Url and add a "http://" in the start again and return it!
    """
    website = cleanURL(website)
    website = ("http://" + website); return(website)

def write(var, data):
    if var == None:
        print(str(data))
    elif var != None:
        print("[" + var + "] " + str(data))

def Request(website, _timeout=None, _encode=None):
    """
    For Getting The Page Source || Source Code Of The Website Given.
    """
    try:
        if _encode == None:
            return requests.get(website, headers=_headers, timeout=_timeout).content
        elif _encode == True:
            return requests.get(website, headers=_headers, timeout=_timeout).text.encode('utf-8')
    except requests.exceptions.MissingSchema:
        pass
    except requests.exceptions.ContentDecodingError:
        pass
    except requests.exceptions.ConnectionError:
        return fg + sb + "\n[$] Error: Sorry! You Entered A Wrong Website Or Website Is Off"
        pass
    except Exception as e:
        return fc + sb + "[$] Error: " + fg + sb + str(e)
        pass



def reverseViaHT(website):
    website = addHTTP(website); webs = removeHTTP(website)
    url = "http://api.hackertarget.com/reverseiplookup/?q="
    combo = "{url}{website}".format(url=url, website=webs)
    request = requests.get(combo, headers=_headers, timeout=5).text.encode('UTF-8')
    if len(request) != 5:
        list = request.strip("").split("\n")
        for _links in list:
            if len(_links) != 0:
                write(var="#", data=_links)
    else:
        write(var="@", data="Sorry, The webserver of the website you entered have no domains other then the one you gave :')")

def reverseViaYGS(website):
    website = addHTTP(website); webs = removeHTTP(website)
    url = "https://domains.yougetsignal.com/domains.php"
    post = {
        'remoteAddress' : webs,
        'key' : ''
    }
    request = requests.post(url, headers=_headers, timeout=5, data=post).text.encode('UTF-8')

    grab = json.loads(request)

    Status = grab['status']
    IP = grab['remoteIpAddress']
    Domain = grab['remoteAddress']
    Total_Domains = grab['domainCount']
    Array = grab['domainArray']

    if (Status == 'Fail'):
        write(var="#", data="Sorry! Reverse Ip Limit Reached.")
    else:
        write(var="$", data="IP: " + IP + "")
        write(var="$", data="Domain: " + Domain + "")
        write(var="$", data="Total Domains: " + Total_Domains + "\n")

        domains = []

        for x, y in Array:
            domains.append(x)

        for res in domains:
            write(var="#", data=res)

def geoip(website):
    website = addHTTP(website); webs = removeHTTP(website)
    url = "http://api.hackertarget.com/geoip/?q="
    combo = "{url}{website}".format(url=url, website=webs)
    request = requests.get(combo, headers=_headers, timeout=5).text.encode('UTF-8')
    if len(request) != 5:
        list = request.strip("").split("\n")
        for _links in list:
            if len(_links) != 0:
                write(var="#", data=_links)
    else:
        write(var="@", data="Sorry, The webserver of the website you entered have no domains other then the one you gave :')")

def pagelinks(website):
    website = addHTTP(website); webs = removeHTTP(website)
    url = "http://api.hackertarget.com/pagelinks/?q="
    combo = "{url}{website}".format(url=url, website=webs)
    request = requests.get(combo, headers=_headers, timeout=5).text.encode('UTF-8')
    if len(request) != 5:
        list = request.strip("").split("\n")
        for _links in list:
            if len(_links) != 0:
                write(var="#", data=_links)
    else:
        write(var="@", data="Sorry, The webserver of the website you entered have no domains other then the one you gave :')")

def httpheaders(website):
    website = addHTTP(website); webs = removeHTTP(website)
    url = "http://api.hackertarget.com/httpheaders/?q="
    combo = "{url}{website}".format(url=url, website=webs)
    request = requests.get(combo, headers=_headers, timeout=5).text.encode('UTF-8')
    if len(request) != 5:
        list = request.strip("").split("\n")
        for _links in list:
            if len(_links) != 0:
                write(var="#", data=_links)
    else:
        write(var="@",data="Sorry, The webserver of the website you entered have no domains other then the one you gave :')")

def hostsearch(website):
    website = addHTTP(website); webs = removeHTTP(website)
    url = "http://api.hackertarget.com/hostsearch/?q="
    combo = "{url}{website}".format(url=url, website=website)
    request = requests.get(combo, headers=_headers, timeout=5).text.encode('UTF-8')
    if len(request) != 5:
        list = request.strip("").split("\n")
        for _links in list:
            if len(_links) != 0:
                write(var="#", data=_links)
    else:
        write(var="@", data="Sorry, The webserver of the website you entered have no domains other then the one you gave :')")

def whois(website):
    website = addHTTP(website); webs = removeHTTP(website)
    url = "http://api.hackertarget.com/whois/?q="
    combo = "{url}{website}".format(url=url, website=webs)
    request = requests.get(combo, headers=_headers, timeout=5).text.encode('UTF-8')
    if len(request) != 5:
        list = request.strip("").split("\n")
        for _links in list:
            if len(_links) != 0:
                write(var="#", data=_links)
    else:
        write(var="@", data="Sorry, The webserver of the website you entered have no domains other then the one you gave :')")

def dnslookup(website):
    website = addHTTP(website); webs = removeHTTP(website)
    url = "http://api.hackertarget.com/dnslookup/?q="
    combo = "{url}{website}".format(url=url, website=webs)
    request = requests.get(combo, headers=_headers, timeout=5).text.encode('UTF-8')
    if len(request) != 5:
        list = request.strip("").split("\n")
        for _links in list:
            if len(_links) != 0:
                write(var="#", data=_links)
    else:
        write(var="@", data="Sorry, The webserver of the website you entered have no domains other then the one you gave :')")

def findshareddns(website):
    website = addHTTP(website); webs = removeHTTP(website)
    url = "http://api.hackertarget.com/findshareddns/?q="
    combo = "{url}{website}".format(url=url, website=webs)
    request = requests.get(combo, headers=_headers, timeout=5).text.encode('UTF-8')
    if len(request) != 5:
        list = request.strip("").split("\n")
        for _links in list:
            if len(_links) != 0:
                write(var="#", data=_links)
    else:
        write(var="@", color=r, data="Sorry, The webserver of the website you entered have no domains other then the one you gave :')")

def heading(heading, website, afterWebHead):
    space = " " * 10
    var = str(heading + " '" + website + "'" + str(afterWebHead))
    length = len(var) + 1; print "" # \n
    print("\n\n" + var)
    print( "-" * length + "--"); print ""

################################  Args  ################################ 

_usage      = "python " + argv[0] + " --all hack.me"
parser      = optparse.OptionParser(usage=_usage, conflict_handler="resolve")
general     = optparse.OptionGroup(parser, "help"+ 'Basic Help')
general.add_option( '-h', '--help', action='help', dest='help', help='Shows the help for program.')

reverse_ip  = optparse.OptionGroup(parser,"IP Tools")
reverse_ip.add_option( "-1", "--revht",  action='store_true', dest='hackertarget', help="Reverse IP via HackTarget")
reverse_ip.add_option( "-2", "--revygs",  action='store_true', dest='yougetsignal', help="Reverse IP via YouGetSignal")
reverse_ip.add_option( "-3", "--geo",  action='store_true', dest='geoip', help="Geo IP Lookup")
reverse_ip.add_option( "-4", "--whois",  action='store_true', dest='whois', help="Whois Lookup")
reverse_ip.add_option( "-5", "--host",  action='store_true', dest='hostsearch', help="Searching Host")
reverse_ip.add_option( "-6", "--dns",  action='store_true', dest='dnslookup', help="DNS Lookup")
reverse_ip.add_option( "-7", "--sdns",  action='store_true', dest='findshareddns', help="Find Shared DNS")
reverse_ip.add_option( "-8", "--http",  action='store_true', dest='httpheaders', help="Show HTTP Header")
reverse_ip.add_option( "-9", "--links",  action='store_true', dest='pagelinks', help="Page Links Scraper")

grouped_scanning = optparse.OptionGroup(parser, "Grouped Results")
grouped_scanning.add_option( "-a", "--all",  action='store_true', dest='all', help="All Things at Once!")



parser.add_option_group(general)
parser.add_option_group(reverse_ip)
parser.add_option_group(grouped_scanning)

(options, args) = parser.parse_args()
try: website = addHTTP(args[0])
except: pass

try:
    if options.geoip:
        heading(heading="Geo IP Lookup", website=website, afterWebHead="")
        geoip(website)

    elif options.yougetsignal:
        heading(heading="Reversing IP via YouGetSignal", website=website, afterWebHead="")
        reverseViaYGS(website)

    elif options.hackertarget:
        heading(heading="Reversing IP via HackTarget", website=website, afterWebHead="")
        reverseViaHT(website)

    elif options.pagelinks:
        heading(heading="Extract Links", website=website, afterWebHead="")
        pagelinks(website)

    elif options.whois:
        heading(heading="Whois Lookup", website=website, afterWebHead="")
        whois(website)

    elif options.hostsearch:
        heading(heading="Searching Host", website=website, afterWebHead="")
        hostsearch(website)

    elif options.dnslookup:
        heading(heading="DNS Lookup", website=website, afterWebHead="")
        dnslookup(website)

    elif options.findshareddns:
        heading(heading="Find Shared DNS", website=website, afterWebHead="")
        findshareddns(website)

    elif options.hostsearch:
        heading(heading="HTTP Header Host", website=website, afterWebHead="")
        httpheaders(website)

    elif options.all:
        heading(heading="Geo IP Lookup", website=website, afterWebHead="")
        geoip(website)

        heading(heading="Reversing IP via YouGetSignal", website=website, afterWebHead="")
        reverseViaYGS(website)

        heading(heading="Reversing IP via HackTarget", website=website, afterWebHead="")
        reverseViaHT(website)

        heading(heading="Whois Lookup", website=website, afterWebHead="")
        whois(website)

        heading(heading="Searching Host", website=website, afterWebHead="")
        hostsearch(website)

        heading(heading="DNS Lookup", website=website, afterWebHead="")
        dnslookup(website)

        heading(heading="Find Shared DNS", website=website, afterWebHead="")
        findshareddns(website)

        heading(heading="HTTP Header Host", website=website, afterWebHead="")
        httpheaders(website)

        heading(heading="Extract Links", website=website, afterWebHead="")
        pagelinks(website)

    else:
        write(var="~", data="Usage: " + "python " + argv[0] + " --help")

except KeyboardInterrupt:
    write(var="~", data="Error: User Interrupted!")

except Exception, e:
    write(var="#", data="Error: Kindly Report the error below to me :) (If Your Internet's Working ;)\n\"\"\"\n" + str(e) + "\n\"\"\"")
